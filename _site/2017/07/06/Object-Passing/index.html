<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <title>Ben Rodenhäuser</title>

  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto+Mono" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/style.css?v=">
  <script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntilConfig">
  </script>
  <script src="/assets/jax/config.js"></script>

  <meta name="viewport" content="width=device-width">
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-99334571-1', 'auto');
        ga('send', 'pageview');
    </script>
  
</head>

  <body>
    <div class="wrapper">
      <section>
      <small>06 July 2017</small>
      <h1 id="object-passing-in-ruby">Object Passing in Ruby</h1>

<p>The following is a description of the object passing strategy followed by Ruby.</p>

<h2 id="pass-by-reference-vs-pass-by-value">Pass-by-reference vs pass-by-value</h2>

<p>The following characterizations come from <a href="http://javadude.com/articles/passbyvalue.htm">this article</a> and are quoted verbatim.</p>

<ul>
  <li><em>Pass-by-value:</em> “The actual parameter (or argument expression) is fully evaluated and the resulting value is <em>copied</em> into a location being used to hold the formal parameter’s value during method/function execution. That location is typically a chunk of memory on the runtime stack for the application (which is how Java handles it), but other languages could choose parameter storage differently.”</li>
  <li><em>Pass-by-reference:</em> “The formal parameter merely acts as an <em>alias</em> for the actual parameter. Anytime the method/function uses the formal parameter (for reading or writing), it is actually using the actual parameter.”</li>
</ul>

<p>Why is the latter called “pass-by-reference”?</p>

<blockquote>
  <p>In programming language design (…) a “reference” is an alias to another variable. Any manipulation done to the reference variable directly changes the original variable.</p>
</blockquote>

<p>What is the consequence of this? If <code class="highlighter-rouge">a</code> acts as an alias for <code class="highlighter-rouge">b</code> in the above sense, then reassigning <code class="highlighter-rouge">a</code> will have the effect of reassigning <code class="highlighter-rouge">b</code>: suppose that <code class="highlighter-rouge">a</code> points to the integer <code class="highlighter-rouge">5</code>, and <code class="highlighter-rouge">b</code> is an alias for <code class="highlighter-rouge">b</code>. Then setting <code class="highlighter-rouge">b = 7</code> will make both <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code> point to <code class="highlighter-rouge">7</code>, because <code class="highlighter-rouge">a</code> and <code class="highlighter-rouge">b</code> are one and the same variable.</p>

<p>So we can think of the pass-by-reference strategy as passing the variable directly into the procedure: there is really only one variable, and one value the variable is bound to. Anything that the procedure does that affects either the variable or its value will be visible to the caller.</p>

<h2 id="an-additional-distinction">An additional distinction</h2>

<p>Ruby does not use pass-by-reference. It uses pass-by-value. However, to get a better grip on object passing in Ruby, it is useful to distinguish two varieties of pass-by-value: “pass-value-by-value”, and “pass-reference-by-value”. This terminology comes from <a href="http://robertheaton.com/2014/07/22/is-ruby-pass-by-reference-or-pass-by-value/">this article</a>, from which the following explanation heavily borrows:</p>

<ol>
  <li><em>Pass-value-by-value:</em> In pass-value-by-value, the procedure receives a <em>copy of the objects</em> passed to it. There is thus no relationship between either the variables or the objects referenced by the values by the function and the caller. Nothing that happens to one will affect the other.</li>
  <li><em>Pass-reference-by-value:</em> On the pass-reference-by-value model, a procedure receives a reference to the same object in memory that is used by the caller, i.e., caller and callee <em>share</em> the object. However, the variable the procedure uses is <em>not</em> merely an alias for the variable used by the caller. The procedure has its own (“fresh”) variable, which merely happens to point to the same object as the caller variable. This means that changes made to the <em>object</em> made inside the procedure will be visible to the caller. But changes made to the <em>variable</em> inside the procedure will not be.</li>
</ol>

<p>Java and C follow the first model. How does Ruby do it? <em>Ruby follows the second model.</em> So the variable passed into a Ruby method is not a “complete alias” for the original variable. It is distinct. But the method variable and the variable used by the caller <em>share a single value</em>.</p>

<h2 id="examples">Examples</h2>

<p>Let’s see the consequences of this with two examples. First, contrast Ruby with the pass-by-reference model.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">reassign</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
  <span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">reassign</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="n">array</span> <span class="c1">#=&gt; [1]</span>
</code></pre>
</div>

<p>In this example, the <code class="highlighter-rouge">reassign</code> method reassigns the variable it receives to another object. In a pass-by-reference language, this would have the effect of reassigning the caller variable <code class="highlighter-rouge">array</code> as well (because the variable used by the caller and the variable used by the method are <em>the same</em>, except for the superficial property of not having the same name). But not so in Ruby: the method uses its own variable, distinct from the variable used by the caller.</p>

<p>So the last line of the above code evaluates to <code class="highlighter-rouge">[1]</code>, not to <code class="highlighter-rouge">[10]</code> as we would expect on the pass-by-reference model. <em>Reassigning a variable within a method will have no effect on the caller in Ruby.</em></p>

<p>Let’s now contrast Ruby with the pass-value-by-value strategy used by Java and C.</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
  <span class="n">array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="k">end</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">mutate</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
<span class="n">array</span> <span class="c1">#=&gt; [10]</span>
</code></pre>
</div>

<p>In this example, the <code class="highlighter-rouge">mutate</code> method mutates the object it receives. In a pass-value-by-value language, this change would not be visible to the caller, since the object used by the method, and the object used by the caller are <em>distinct</em>. But not so in Ruby: the object is shared between caller variable and method variable, so the mutation of the array object will be visible to the caller.</p>

<p>As a consequence, the last line of the above code evaluates to <code class="highlighter-rouge">[10]</code>, not to <code class="highlighter-rouge">[1]</code> as we would expect on a pass-value-by-value model. <em>Mutating an object within a method will have an effect on the caller in Ruby.</em></p>

<h3 id="takeaway">Takeaway</h3>

<p>Ruby is not a <em>pass-by-reference</em> language, it is a <em>pass-by-value</em> language. But it is not a <em>pass-value-by-value</em> language, it’s <em>pass-reference-by-value</em>. Reassignment of a variable within a method will never affect the original variable that lives outside the method. On the other hand, mutating an object within a method will affect the original object outside the method, because those two objects are shared.</p>

      </section>
      <header>
  <small>&nbsp;</small>
  <a href="http://notes.benrodenhaeuser.io">
    <h1>Ben Rodenhäuser</h1>
  </a>
  <p>Learning to program</p>
  <hr />
  <p>
      

          <h3>
            <a class="post-link" href="/2017/07/06/Object-Passing/">Object passing</a><span class="pad"></span><small>06 Jul 2017</small>
          </h3>
      

          <h3>
            <a class="post-link" href="/2017/07/06/object-passing/">Object Passing</a><span class="pad"></span><small>06 Jul 2017</small>
          </h3>
      

          <h3>
            <a class="post-link" href="/2017/06/18/Modular-Arithmetic_2/">Modular arithmetic_2</a><span class="pad"></span><small>18 Jun 2017</small>
          </h3>
      

          <h3>
            <a class="post-link" href="/2017/05/31/negamax/">Negamax</a><span class="pad"></span><small>31 May 2017</small>
          </h3>
      

          <h3>
            <a class="post-link" href="/2017/05/15/sorting-in-ruby/">Sorting In Ruby</a><span class="pad"></span><small>15 May 2017</small>
          </h3>
      
  </p>
  <hr />
  <p><small><a href="http://github.com/benrodenhaeuser">GitHub Profile</a></small></p>
</header>

      <!-- <footer>
  <p><small>Ben Rodenhäuser 2017 | <a href="http://github.com/benrodenhaeuser">GitHub Profile</a></small></p>
</footer> -->

    </div>
    <script src="/assets/js/scale.fix.js"></script>
  </body>
</html>
